================================================================================
  ARC Monitor — MCP 연동 가이드 (에이전트용)
  version: 2.0.0
================================================================================

ARC Monitor는 외부 에이전트를 모니터링하는 대시보드입니다.
이 문서를 읽고 아래 절차대로 MCP 도구를 호출하면
ARC 대시보드에 자동 등록되고, 대화 로그가 실시간으로 기록됩니다.


────────────────────────────────────────────────────────────────────────────────
1. MCP 서버 연결 정보
────────────────────────────────────────────────────────────────────────────────

  서버 이름 : arc-monitor-mcp
  전송 방식 : stdio
  실행 명령 : cd ~/arc-v2 && npm run mcp
             (내부: tsx src/mcp/server.ts)

  필요 환경변수 (이미 ~/arc-v2/.env에 설정됨):
    SUPABASE_URL
    SUPABASE_ANON_KEY

  Claude Code에서 사용 시 ~/.claude/claude_desktop_config.json 또는
  프로젝트의 .mcp.json에 아래처럼 등록:

    {
      "mcpServers": {
        "arc-monitor": {
          "command": "npm",
          "args": ["run", "mcp"],
          "cwd": "/Users/vimo/arc-v2"
        }
      }
    }


────────────────────────────────────────────────────────────────────────────────
2. 사용 가능한 MCP 도구 목록
────────────────────────────────────────────────────────────────────────────────

┌─────────────────────┬──────────────────────────────────────────────────┐
│ 도구 이름            │ 용도                                            │
├─────────────────────┼──────────────────────────────────────────────────┤
│ arc_register_agent  │ 에이전트 등록 또는 업데이트                       │
│ arc_push_message    │ 대화 메시지를 ARC에 기록                          │
│ arc_heartbeat       │ 상태(온라인/오프라인/에러) 보고                    │
│ arc_list_agents     │ 등록된 에이전트 목록 조회                         │
│ arc_get_messages    │ 특정 세션의 메시지 조회                           │
│ arc_list_sessions   │ 채팅 세션 목록 조회                               │
└─────────────────────┴──────────────────────────────────────────────────┘


────────────────────────────────────────────────────────────────────────────────
3. 에이전트 자동 등록 절차
────────────────────────────────────────────────────────────────────────────────

에이전트가 처음 실행될 때, 아래 순서로 호출하세요.

  [STEP 1] arc_register_agent — 자기 자신을 등록

    호출 예시:
    {
      "id": "my-agent",
      "name": "My Agent",
      "description": "유튜브 자막을 요약하는 에이전트",
      "type": "custom"
    }

    파라미터:
      id          (필수) 에이전트 고유 ID. 소문자+하이픈 형식. 예: "yt-summary"
      name        (필수) 대시보드에 표시될 이름. 예: "YT 요약봇"
      description (선택) 에이전트 설명
      type        (선택) "telegram" | "discord" | "slack" | "custom" (기본: custom)
      telegramBotToken (선택) 텔레그램 봇 토큰 (type이 telegram인 경우)
      telegramChatId   (선택) 기본 텔레그램 채팅 ID
      metadata    (선택) 임의의 JSON 객체. 버전, 설정값 등 자유롭게 저장 가능

    응답:
    {
      "agent": { "id": "my-agent", "name": "My Agent", ... },
      "registered": true
    }

    * 같은 id로 다시 호출하면 정보가 업데이트됩니다 (upsert).
    * 등록 시 status가 자동으로 "online"이 됩니다.


  [STEP 2] arc_heartbeat — 주기적으로 상태 보고 (선택, 권장)

    호출 예시:
    {
      "agentId": "my-agent",
      "status": "online"
    }

    파라미터:
      agentId  (필수) 에이전트 ID
      status   (선택) "online" | "offline" | "error" (기본: online)

    * 주기적(예: 5분마다)으로 호출하면 대시보드에서 온/오프라인 여부를 확인 가능
    * 종료 시 status: "offline"으로 한 번 보내면 좋습니다


  [STEP 3] arc_push_message — 대화 로그 기록

    호출 예시 (세션 자동 생성):
    {
      "agentId": "my-agent",
      "role": "user",
      "content": "유튜브 링크 요약해줘: https://..."
    }

    호출 예시 (기존 세션에 추가):
    {
      "sessionId": "기존-세션-id",
      "role": "assistant",
      "content": "요약 결과: ..."
    }

    파라미터:
      sessionId (선택) 기존 세션 ID. 없으면 agentId로 새 세션 자동 생성
      agentId   (선택) 세션 자동 생성 시 필요
      role      (필수) "user" | "assistant" | 에이전트 이름
      content   (필수) 메시지 내용

    * sessionId가 없고 agentId만 있으면 → 새 세션이 자동 생성됩니다
    * 같은 대화를 이어가려면 응답의 sessionId를 저장해두고 재사용하세요

    응답:
    {
      "message": { "id": "...", "session_id": "...", ... },
      "sessionId": "세션-id",
      "pushed": true
    }


────────────────────────────────────────────────────────────────────────────────
4. 조회 도구 (읽기 전용)
────────────────────────────────────────────────────────────────────────────────

  arc_list_agents — 등록된 전체 에이전트 조회

    파라미터: 없음
    응답: { "agents": [...], "count": N }


  arc_list_sessions — 세션 목록 조회

    파라미터:
      agentId (선택) 특정 에이전트의 세션만 필터링

    응답: { "sessions": [...], "count": N }


  arc_get_messages — 특정 세션의 메시지 조회

    파라미터:
      sessionId (필수) 세션 ID

    응답: { "messages": [...], "count": N }


────────────────────────────────────────────────────────────────────────────────
5. 빠른 시작 — 복사해서 바로 쓰는 전체 플로우
────────────────────────────────────────────────────────────────────────────────

아래 3단계를 순서대로 호출하면 됩니다:

  // 1) 등록
  arc_register_agent({
    "id": "내-에이전트-id",
    "name": "내 에이전트 이름",
    "description": "이 에이전트가 하는 일",
    "type": "custom"
  })

  // 2) 사용자 메시지 기록 (세션 자동 생성)
  arc_push_message({
    "agentId": "내-에이전트-id",
    "role": "user",
    "content": "사용자가 보낸 메시지"
  })
  // → 응답에서 sessionId를 저장

  // 3) 에이전트 응답 기록 (같은 세션에 추가)
  arc_push_message({
    "sessionId": "위에서-받은-sessionId",
    "role": "assistant",
    "content": "에이전트의 응답 내용"
  })

이후 주기적으로:
  arc_heartbeat({ "agentId": "내-에이전트-id" })

종료 시:
  arc_heartbeat({ "agentId": "내-에이전트-id", "status": "offline" })


────────────────────────────────────────────────────────────────────────────────
6. 주의사항
────────────────────────────────────────────────────────────────────────────────

  - id는 소문자와 하이픈만 사용하세요 (예: "yt-summary-bot")
  - 같은 id로 arc_register_agent를 재호출하면 기존 정보가 덮어씌워집니다
  - arc_push_message에서 sessionId와 agentId 둘 다 없으면 에러가 발생합니다
  - 모든 응답은 JSON 형식입니다
  - 에러 발생 시 { "error": "에러 메시지" } 형태로 반환됩니다
  - 대시보드 웹 UI: http://localhost:3300 (개발 서버)

================================================================================
